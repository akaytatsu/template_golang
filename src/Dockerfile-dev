FROM golang:1.19.0-alpine3.16 AS base

ENV GO111MODULE="on"
ENV GOOS="linux"
ENV CGO_ENABLED=0

# System dependencies
RUN apk add --no-cache ca-certificates curl

ARG PROJECT_NAME="app"
ARG VERSION="dev"
ARG COMMIT="none"
ENV CGO_ENABLED=0
ENV GOPROXY=https://proxy.golang.org

FROM base AS dev
WORKDIR /app

COPY . .

RUN go mod download
RUN go install github.com/go-delve/delve/cmd/dlv@latest

# Hot reloading mod
RUN go get -u github.com/cosmtrek/air && go install github.com/go-delve/delve/cmd/dlv@latest

RUN curl -fLo install.sh https://raw.githubusercontent.com/cosmtrek/air/master/install.sh \
    && chmod +x install.sh && sh install.sh && cp ./bin/air /bin/air

EXPOSE 8080
EXPOSE 2345

ENTRYPOINT ["air"]
